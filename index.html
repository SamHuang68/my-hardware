<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Hardware Asset Registry | Sam Huang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0a0a; color: #d1d5db; font-family: 'Consolas', monospace; overflow-x: hidden; }
        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 2.5rem; background: #111; }
        .data-table th, .data-table td { border: 1px solid #333; padding: 14px; text-align: left; font-size: 0.85rem; vertical-align: middle; }
        .data-table th { background: #1a1a1a; color: #3b82f6; text-transform: uppercase; }
        .tag-mop { background: #1e3a8a; color: #60a5fa; padding: 2px 5px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .section-title { font-size: 1.3rem; font-weight: bold; color: #fff; margin: 2rem 0 1rem 0; border-left: 5px solid #3b82f6; padding-left: 1.2rem; }
        
        /* Highlight Glow Effect Styles */
        .data-table tbody tr {
            transition: all 0.3s ease;
        }
        .data-table tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.1);
            transform: scale(1.01);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            outline: 2px solid #3b82f6; 
            outline-offset: -1px;
            z-index: 10;
            position: relative;
        }
        .data-table tbody tr:hover td {
            color: #ffffff;
            border-color: transparent;
        }

        /* Device Thumbnail Styles */
        .device-thumb {
            width: 72px;
            height: 72px;
            object-fit: contain;
            margin: 0 auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.8));
            transition: transform 0.3s ease;
        }
        .data-table tbody tr:hover .device-thumb {
            transform: scale(1.15);
        }
    </style>
</head>
<body class="p-8 lg:p-16">
    <header class="mb-12 border-b border-gray-800 pb-6">
        <h1 class="text-3xl font-black text-white uppercase italic tracking-tighter">Hardware <span class="text-blue-500 font-sans">Command Center</span></h1>
        <p id="meta-info" class="text-gray-500 text-sm mt-2 font-mono"></p>
    </header>
    <div id="registry-container"></div>
    <script>
        async function init() {
            try {
                // 使用快取消除機制確保讀取最新 data.json
                const res = await fetch('data.json?cache_bust=' + Date.now());
                if (!res.ok) throw new Error('Data file not found');
                const data = await res.json();
                
                document.getElementById('meta-info').innerText = `LAST SYNC: ${data.last_updated} | OWNER: ${data.inventory_owner}`;
                const container = document.getElementById('registry-container');

                container.innerHTML += `<div class="section-title">I. COMPUTING SYSTEMS</div>`;
                
                let table = `<table class="data-table"><thead><tr><th class="text-center">Form Factor</th><th>System</th><th>CPU / Arch</th><th>RAM (MoP)</th><th>Storage</th><th>GPU / PSU Detail</th></tr></thead><tbody>`;

                data.hardware_registry.forEach(h => {
                    let formFactor = "Unknown";
                    let imgFileName = "default.png";

                    // 依照設備 ID 分配對應的圖片檔名
                    if (h.id.includes("DESKTOP")) {
                        formFactor = "Desktop"; 
                        imgFileName = "desktop.png";
                    } else if (h.id.includes("HANDHELD")) {
                        formFactor = "Handheld"; 
                        imgFileName = "msi_claw.png";
                    } else if (h.id.includes("LAPTOP")) {
                        formFactor = "Laptop"; 
                        imgFileName = "dell_laptop.png";
                    } else if (h.id.includes("STATION") || h.id.includes("MINI")) {
                        formFactor = "Mini PC"; 
                        imgFileName = "gmk_evo_t1.png";
                    }

                    // 防呆機制：若本地端無圖片，顯示深色佔位圖案
                    const fallbackImg = "https://placehold.co/72x72/1a1a1a/3b82f6?text=IMG";
                    const imgTag = `<img src="images/${imgFileName}" alt="${formFactor}" class="device-thumb" onerror="this.onerror=null; this.src='${fallbackImg}';">`;

                    const ramDisplay = h.ram.spec.includes('MoP') ? `<span class="tag-mop">MoP</span> ${h.ram.spec}` : h.ram.spec;
                    
                    let gpuDisplay = "";
                    if (h.gpu.external) {
                        gpuDisplay = `Ext: ${h.gpu.external}<br>Int: ${h.gpu.internal}`;
                    } else if (typeof h.gpu === 'object') {
                        gpuDisplay = h.gpu.model;
                    } else {
                        gpuDisplay = h.gpu;
                    }

                    let psuDisplay = h.power_supply ? `PSU: ${h.power_supply}` : "";

                    table += `<tr>
                        <td class="text-center w-32">
                            <div class="mb-2">${imgTag}</div>
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">${formFactor}</div>
                        </td>
                        <td class="font-bold text-blue-400 text-base">${h.name}</td>
                        <td><span class="font-bold text-gray-200">${h.cpu.model}</span><br><span class="text-gray-500 text-xs">${h.cpu.architecture}</span></td>
                        <td>${ramDisplay}</td>
                        <td>${h.storage.primary}</td>
                        <td class="text-gray-300">
                            <span class="text-blue-300">GPU:</span> ${gpuDisplay}<br>
                            ${psuDisplay ? `<span class="text-emerald-400">PSU:</span> ${h.power_supply}` : ""}
                            ${h.motherboard ? `<br><span class="text-purple-400">Mobo:</span> ${h.motherboard}` : ""}
                            ${h.case ? `<br><span class="text-gray-400">Case:</span> ${h.case}` : ""}
                        </td>
                    </tr>`;
                });
                table += `</tbody></table>`;
                container.innerHTML += table;

                container.innerHTML += `<div class="section-title">II. VISUAL ASSETS</div>`;
                let dTable = `<table class="data-table"><thead><tr><th>Model</th><th>Panel</th><th>Specifications</th></tr></thead><tbody>`;
                data.display_assets.forEach(d => {
                    dTable += `<tr><td class="font-bold text-blue-400">${d.name}</td><td>${d.panel}</td><td>${d.specs}</td></tr>`;
                });
                dTable += `</tbody></table>`;
                container.innerHTML += dTable;
            } catch (e) {
                document.getElementById('registry-container').innerHTML = `<p class="text-red-500 font-bold p-4 bg-red-900/20 border border-red-500 rounded">DATABASE ERROR: ${e.message}. Please check data.json file format or server status.</p>`;
            }
        }
        init();
    </script>
</body>
</html>
